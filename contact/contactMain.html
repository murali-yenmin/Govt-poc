<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matter.js Simulation with Rotating Text</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
        }

        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #000;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <div id="loading">Loading...</div> <!-- Loading screen -->

    <canvas id="world"></canvas>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.17.1/matter.min.js"></script>

    <script>
        const { Engine, Render, World, Bodies, Body, Events, Composite, Mouse, MouseConstraint, Vector } = Matter;

        const minRandomValue = window.innerWidth * 0.2;
        const maxRandomValue = window.innerWidth * 0.8;

        function getRandomNumber(x, y) {
            return Math.floor(Math.random() * (y - x + 1)) + x;
        }

        // sample circle
        // {
        //     type: 'circle',
        //     color: 'red',
        //     title: 'Red Circle',
        //     text: 'Circle',
        //     radius: 50,
        //     x: topCenter,
        //     y: 0,
        //     restitution: 0,
        //     link: 'https://example333.com',
        //     fontSize: '16px',
        //     fontWeight: 'normal'
        // },
        const SHAPESDATA = [
            {
                type: 'box',
                color: '#FF5000',
                title: '',
                text: 'NEW BUSINESS',
                width: 700,
                height: 154,
                x: getRandomNumber(minRandomValue, maxRandomValue),
                y: 0,
                restitution: 0,
                link: 'https://newBussiness.com',
                fontSize: '70px',
                fontWeight: '700',
                titleY: 0,
                textY: 0,
                titleX: 0,
                textX: 0,
                textColor: 'white',
                hoverCursor: true
            },
            {
                type: 'box',
                color: '#FF5000',
                title: '',
                text: 'CAREERS',
                width: 400,
                height: 144,
                x: getRandomNumber(minRandomValue, maxRandomValue),
                y: 0,
                restitution: 0,
                link: 'https://careers.com',
                fontSize: '50px',
                titleY: 0,
                textY: 0,
                titleX: 0,
                textX: 0,
                fontWeight: '700',
                textColor: 'white',
                hoverCursor: true
            },
            {
                type: 'box',
                color: '#FFF5DC',
                title: '',
                text: 'COLLABORATION',
                width: 750,
                height: 144,
                x: getRandomNumber(minRandomValue, maxRandomValue),
                y: 0,
                restitution: 0,
                link: 'https://collaboration.com',
                fontSize: '70px',
                titleY: 0,
                textY: 0,
                titleX: 0,
                textX: 0,
                textColor: 'black',
                fontWeight: '700',
                hoverCursor: true
            },
            {
                type: 'box',
                color: '#D9D9D9',
                title: '',
                text: 'LOCATION',
                width: 500,
                height: 144,
                x: getRandomNumber(minRandomValue, maxRandomValue),
                y: 0,
                restitution: 0,
                link: 'https://location.com',
                fontSize: '70px',
                titleY: 0,
                textY: 0,
                titleX: 0,
                textX: 0,
                textColor: 'black',
                fontWeight: '700'
            },
            {
                type: 'box',
                color: '#FFF5DC',
                title: 'CONTACT',
                text: 'example@example.com',
                width: 400,
                height: 144,
                x: getRandomNumber(minRandomValue, maxRandomValue),
                y: 0,
                restitution: 0,
                fontSize: '30px',
                titleY: -10,
                textY: 20,
                titleX: -114,
                textX: 0,
                textColor: 'black',
                fontWeight: '500',
                titleFontWeight: '500',
                titleFontSize: '20px',
                hoverCursor: true,
                copyText: true
            },
            {
                type: 'image',
                src: './image/insta.PNG',
                title: 'Image Shape',
                link: 'https://insta.com',
                x: getRandomNumber(minRandomValue, maxRandomValue),
                y: 0,
                width: 185,
                height: 185,
                hoverCursor: true,
                restitution: 0
            },
            {
                type: 'image',
                src: './image/insta.PNG',
                title: 'Image Shape',
                link: 'https://facebook.com',
                x: getRandomNumber(minRandomValue, maxRandomValue),
                y: 0,
                width: 185,
                height: 185,
                hoverCursor: true,
                restitution: 0
            },
            {
                type: 'image',
                src: './image/insta.PNG',
                title: 'Image Shape',
                link: 'https://telegram.com',
                x: getRandomNumber(minRandomValue, maxRandomValue),
                y: 0,
                width: 185,
                height: 185,
                hoverCursor: true,
                restitution: 0
            },
            {
                type: 'image',
                src: './image/insta.PNG',
                title: 'Image Shape',
                link: 'https://youtube.com',
                x: getRandomNumber(minRandomValue, maxRandomValue),
                y: 0,
                width: 185,
                height: 185,
                hoverCursor: true,
                restitution: 0
            },
            {
                type: 'image',
                src: './image/arrow.PNG',
                title: 'Image Shape',
                link: 'https://arrow.com',
                x: getRandomNumber(minRandomValue, maxRandomValue),
                y: 0,
                width: 185,
                height: 185,
                restitution: 0
            },
        ];

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Randomize SHAPES array
        const SHAPES = shuffleArray([...SHAPESDATA]);

        // Preload all images
        const preloadImages = () => {
            const imagePromises = SHAPES.filter(shape => shape.type === 'image').map(shape => {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.src = shape.src;
                    img.onload = () => {
                        shape.img = img;
                        resolve(img);
                    };
                    img.onerror = reject;
                });
            });

            return Promise.all(imagePromises); // Wait for all images to load
        };

        // Trigger image loading as soon as the page loads
        window.onload = function () {
            preloadImages()
                .then(() => {
                    document.getElementById('loading').style.display = 'none'; // Hide loading screen once images are loaded
                    startSimulation(); // Start the simulation
                })
                .catch(error => {
                    console.error("Error loading images:", error);
                    document.getElementById('loading').textContent = 'Error loading images, please try again.';
                });
        };

        function startSimulation() {
            const engine = Engine.create();
            const world = engine.world;

            const render = Render.create({
                element: document.body,
                canvas: document.getElementById('world'),
                engine: engine,
                options: {
                    width: window.innerWidth,
                    height: window.innerHeight,
                    wireframes: false,
                    background: '#f0f0f0'
                }
            });

            const boundaryThickness = 100;

            const boundaries = [
                Bodies.rectangle(window.innerWidth / 2, -boundaryThickness / 2, window.innerWidth, boundaryThickness, {
                    isStatic: true,
                    render: { fillStyle: '#8b8b8b' }
                }),
                Bodies.rectangle(-boundaryThickness / 2, window.innerHeight / 2, boundaryThickness, window.innerHeight, {
                    isStatic: true,
                    render: { fillStyle: '#8b8b8b' }
                }),
                Bodies.rectangle(window.innerWidth + boundaryThickness / 2, window.innerHeight / 2, boundaryThickness, window.innerHeight, {
                    isStatic: true,
                    render: { fillStyle: '#8b8b8b' }
                }),
                Bodies.rectangle(window.innerWidth / 2, window.innerHeight + boundaryThickness / 2, window.innerWidth, boundaryThickness, {
                    isStatic: true,
                    render: { fillStyle: '#8b8b8b' }
                })
            ];

            World.add(world, boundaries);

            let shapeIndex = 0; // Start index for shape creation
            let delay = 1000; // Initial delay (1 second)

            // Create shapes one by one with a delay
            function createNextShape() {
                if (shapeIndex < SHAPES.length) {
                    const shape = SHAPES[shapeIndex];
                    let body;
                    let randomAngle = Math.random() * 2 * Math.PI; // Random angle between 0 and 2Ï€
                    let randomAngularVelocity = (Math.random() - 0.5) * 0.05; // Random angular velocity

                    if (shape.type === 'box') {
                        body = Bodies.rectangle(shape.x, shape.y, shape.width, shape.height, {
                            restitution: shape.restitution,
                            render: { fillStyle: shape.color },
                            angle: randomAngle, // Set the initial random rotation
                        });
                    } else if (shape.type === 'circle') {
                        body = Bodies.circle(shape.x, shape.y, shape.radius, {
                            restitution: shape.restitution,
                            render: { fillStyle: shape.color },
                            angle: randomAngle, // Set the initial random rotation
                        });
                    } else if (shape.type === 'image' && shape.img) {
                        body = Bodies.rectangle(shape.x, shape.y, shape.width, shape.height, {
                            restitution: shape.restitution,
                            render: { fillStyle: 'transparent' },
                        });
                    }

                    // Apply a random angular velocity to make the shape rotate while falling
                    if (body) Body.setAngularVelocity(body, randomAngularVelocity);

                    World.add(world, body);
                    shape.body = body;
                    shapeIndex++;

                    // Reduce the delay for the next shape (e.g., reduce by 100ms each time, but not below 200ms)
                    delay = Math.max(200, delay - 100); // Decrease delay, but keep it above 200ms

                    // Create the next shape after the reduced delay
                    setTimeout(createNextShape, delay); // Delay in ms
                }
            }

            // Start the shape creation process
            createNextShape();

            // Create the mouse constraint for drag functionality
            const mouse = Mouse.create(render.canvas);
            const mouseConstraint = MouseConstraint.create(engine, {
                mouse: mouse,
                constraint: {
                    stiffness: 0.2,
                    render: { visible: false }
                }
            });
            World.add(world, mouseConstraint);


            Engine.run(engine);
            Render.run(render);

            (function renderText() {
                const context = render.context;

                SHAPES.forEach((shape) => {
                    const body = shape.body;
                    if (body) {
                        context.save(); // Save the current context
                        context.translate(body.position.x, body.position.y); // Move the context to the shape's position
                        context.rotate(body.angle); // Rotate the context by the shape's angle

                        // Render title and text inside the shape
                        if (shape.type === 'image' && shape.img) {
                            context.drawImage(shape.img, -shape.width / 2, -shape.height / 2, shape.width, shape.height);
                        } else {
                            context.font = `${shape.fontWeight} ${shape.fontSize} Arial`; // Font for shape title and text
                            context.fillStyle = shape.textColor; // Shape text color
                            context.textAlign = 'center';
                            context.textBaseline = 'middle';
                            context.fillText(shape.text, shape.textX, shape.textY); // Text inside the box

                            if (shape.title) {
                                context.font = `${shape.titleFontWeight} ${shape.titleFontSize} Arial`; // Font for shape title and text
                                context.fillStyle = shape.titleColor; // Shape text color
                                context.fillText(shape.title, shape.titleX, shape.titleY); // Title at the top of the box
                            }
                        }

                        context.restore();
                    }
                });

                requestAnimationFrame(renderText);
            })();

            function hoverStyle() {
                let isHovering = false;
                SHAPES.forEach(shape => {
                    const body = shape.body;
                    if (body && shape.hoverCursor) {
                        const distance = Math.hypot(event.clientX - body.position.x, event.clientY - body.position.y);
                        if (distance < 100) {
                            isHovering = true;
                        }
                    }
                });

                // Set cursor style based on hovering state
                render.canvas.style.cursor = isHovering ? 'pointer' : 'default';
            }

            let clickStartTime = 0;
            let clickStartPosition = { x: 0, y: 0 };
            let isDragging = false;
            let isClicking = false;
            const DRAG_THRESHOLD = 10;
            const CLICK_THRESHOLD = 300;

            render.canvas.addEventListener('mousedown', function (event) {
                clickStartTime = Date.now();
                clickStartPosition = { x: event.clientX, y: event.clientY };
                isDragging = false;
                isClicking = true;
            });

            render.canvas.addEventListener('mousemove', function (event) {
                hoverStyle();
                const distance = Math.hypot(event.clientX - clickStartPosition.x, event.clientY - clickStartPosition.y);
                if (distance > DRAG_THRESHOLD) {
                    isDragging = true;
                }
            });

            render.canvas.addEventListener('mouseup', function (event) {
                const duration = Date.now() - clickStartTime;
                if (!isDragging && isClicking && duration < CLICK_THRESHOLD) {
                    SHAPES.forEach(shape => {
                        const body = shape.body;
                        console.log("body: ", body);

                        const distance = Math.hypot(event.clientX - body.position.x, event.clientY - body.position.y);
                        if (distance < 100) {
                            if (shape.link) {
                                window.open(shape.link, '_blank');
                            }
                            if (shape.copyText) {
                                const previousText = shape.text;
                                const previousTextX = shape.textX;
                                navigator.clipboard.writeText(shape.text).then(() => {
                                    // Change the text of the shape to "Copied!"
                                    shape.text = "Copied!";
                                    shape.textX = -112;

                                    // Optional: Restore the original text after a short delay
                                    setTimeout(() => {
                                        shape.text = previousText; // Replace with the original text
                                        shape.textX = previousTextX; // Replace with the original text
                                    }, 1000); // Delay in milliseconds
                                });
                            }
                        }

                    });
                }
                isClicking = false;
            });
        }
    </script>

</body>

</html>